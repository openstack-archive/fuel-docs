
.. _updates-nova-rn:

OpenStack Compute (Nova)
------------------------

Resolved Issues
+++++++++++++++

* CVE-2015-0259 vulnerability has been fixed in the Nova console websocket.
  By tricking an authenticated user into clicking a malicious URL, a remote
  attacker was able to trigger a cross-site-websocket-hijacking vulnerability
  resulting in a potential hijack of consoles where a user was still logged in.
  See `LP1420273`_.

* Previously, when RabbitMQ failed, a consumer had been disconnected
  before a publisher sent a message. Currently, if the consumer has not
  declared a queue, the publisher does not send a message to an exchange
  that is not bound to a queue to prevent a message loss. Setting
  ``passive = True`` does not cause a publisher failure anymore,
  and it retries if a consumer has not declared the receiving queue yet.
  See `LP1427892`_.

* The issue of noVNC access to VMs when reverse DNS lookups fail has been fixed.
  See `LP1409661`_.

* If a user specifies an IP address using the :option:`--nic` option while booting
  an instance with the :command:`nova boot` command, a Compute node invokes
  the neutron client to create a port. However, as the IP address parameter used to
  be an IPAddress object, the neutron client failed to send the request to the neutron
  server.
  See `LP1435712`_.

* The update resolves nova-compute graceful shutdown issue: nova-compute no longer
  hangs waiting for the external events that cannot be processed. All tasks waiting
  for such events (plugging of VIFs by Neutron L2 agent, for example), are cancelled immediately
  upon the SIGTERM signal receiving. Previously, nova-compute did not exit properly,
  but waited for the external events which would never be triggered.
  See `LP1433605`_.

* By now, Nova allows booting an instance from a QCOW2 image with the virtual size greater
  than the ``root_gb`` size specified in a flavor.
  See `LP1427839`_.

* Previously, it was impossible to create a snapshot of a virtual machine spun up from
  another snapshot, as the location of the respective information in a glance image
  and a snapshot object differed. The update resolves the issue.
  See `LP1431951`_.

* Juno controller and Icehouse compute are now able to backport a Service object correctly.
  Previously, when backporting the Service object to the Icehouse version, the embedded
  ComputeNode object was sent back to the wrong version.
  See `LP1436819`_.

* The deletion of an instance, when using Juno controller and Icehouse compute, does not
  cause an infinite loop anymore. This is achieved by the backporting of a FixedIP
  object with an embedded version of a Network object added with this update.
  See `LP1436825`_.

* Currently, Nova-compute is able to restart successfully, even if ``_init_instance``
  fails. Previously, the compute process used to exit unexpectedly in case an unhandled
  exception was raised from an instance.
  See `LP1438680`_.

* The update fixes the issue with detaching of multipath volumes when using different
  targets with the same portal.
  See `LP1443974`_.

* The update fixes the multipath performance issues with the ``connect_volume`` and similar
  functions.
  See `LP1443977`_.

* Previously, ``_poll_connection`` could fall into a loop waiting for
  a reply message if RabbitMQ was down and up after a reboot. The
  issue is fixed. See `LP1454174`_.

* API is updated to pass the context explicitly, rather than getting
  it from the respective surrounding code. Also, the snapshot method
  is updated to pass context to ``detach_sriov_ports``.
  See `LP1452294`_.

* When the volume is detached immediately after attachment, there was
  a race condition between updating the volume status and saving
  information to the database. This was fixed by saving information
  to the database before the volume attachment. See `LP1457041`_.

* If you resize an existing instance to a larger flavor and later
  delete it, the ``scp`` and ``rsync`` processes continue running until
  they finish transferring the file data.
  If during the ``scp`` and ``rsync`` processes execution the user
  repeats that operation, it may lead to the disk space reduction on
  the Compute nodes, as well as may impact the management network.
  A new module *instancejobtracker* added to the libvirt driver
  eliminates this issue. The module adds, removes, or terminates the
  processes running against particular instances. Therefore, now the
  ``scp`` and ``rsync`` processes are terminated before you delete an
  instance. See `LP1466077`_.

* If Nova boots a VM with a pre-created Neutron port, this port will
  be deleted once you remove the VM. The fix disassociates the
  existing port from the instance instead of deleting it when you
  remove a VM. See `LP1486727`_.

* When nova-compute fails over, it creates a new folder with
  cached images and downloads them again. It happens when you use
  nova-compute with VMware vCenter and set the
  :option:`remove_unused_base_images` option. This may result in a
  longer VM booting time.
  The fix introduces a new configuration option :option:`cache_prefix`
  that allows using a shared folder to speed up the VM booting time.
  See `LP1482121`_.

.. Links
.. _`LP1420273`: https://bugs.launchpad.net/mos/+bug/1420273
.. _`LP1427892`: https://bugs.launchpad.net/mos/+bug/1427892
.. _`LP1409661`: https://bugs.launchpad.net/mos/+bug/1409661
.. _`LP1435712`: https://bugs.launchpad.net/mos/+bug/1435712
.. _`LP1433605`: https://bugs.launchpad.net/mos/+bug/1433605
.. _`LP1427839`: https://bugs.launchpad.net/mos/+bug/1427839
.. _`LP1431951`: https://bugs.launchpad.net/mos/+bug/1431951
.. _`LP1436819`: https://bugs.launchpad.net/mos/+bug/1436819
.. _`LP1436825`: https://bugs.launchpad.net/mos/+bug/1436825
.. _`LP1438680`: https://bugs.launchpad.net/mos/+bug/1438680
.. _`LP1443974`: https://bugs.launchpad.net/mos/+bug/1443974
.. _`LP1443977`: https://bugs.launchpad.net/mos/+bug/1443977
.. _`LP1454174`: https://bugs.launchpad.net/mos/+bug/1454174
.. _`LP1452294`: https://bugs.launchpad.net/mos/+bug/1452294
.. _`LP1457041`: https://bugs.launchpad.net/mos/+bug/1457041
.. _`LP1466077`: https://bugs.launchpad.net/mos/+bug/1466077
.. _`LP1486727`: https://bugs.launchpad.net/mos/+bug/1486727
.. _`LP1482121`: https://bugs.launchpad.net/mos/+bug/1482121